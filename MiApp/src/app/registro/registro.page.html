<ion-header>
  <ion-toolbar>
    <ion-title>Crear cuenta</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="registro">
  <ion-grid fixed>
    <ion-row>
      <ion-col size="12" sizeMd="8" offsetMd="2">
        <ion-card>
          <ion-card-header>
            <ion-card-title>Registro</ion-card-title>
            <ion-card-subtitle>Completá tus datos</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <form #f="ngForm" (ngSubmit)="onSubmit(f)" novalidate>
              <!-- Correo -->
              <ion-item [class.invalid]="emailCtrl.invalid && emailCtrl.touched">
                <ion-label position="stacked">Correo</ion-label>
                <ion-input
                  type="email" inputmode="email" autocomplete="email"
                  required email
                  [(ngModel)]="email" name="email" #emailCtrl="ngModel"
                  placeholder="tucorreo@dominio.com">
                </ion-input>
              </ion-item>
              <ion-note color="danger" *ngIf="emailCtrl.touched && emailCtrl.invalid">
                Ingresá un correo válido.
              </ion-note>

              <!-- Clave -->
              <ion-item class="ion-margin-top" [class.invalid]="passCtrl.invalid && passCtrl.touched">
                <ion-label position="stacked">Clave</ion-label>
                <ion-input
                  [type]="showPwd ? 'text' : 'password'"
                  required minlength="6"
                  [(ngModel)]="password" name="password" #passCtrl="ngModel"
                  placeholder="Mínimo 6 caracteres"
                  (ionInput)="checkMatch()">
                </ion-input>
                <ion-button fill="clear" slot="end" type="button" (click)="togglePwd()" aria-label="Mostrar/Ocultar clave">
                  <ion-icon [name]="showPwd ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                </ion-button>
              </ion-item>
              <ion-note color="danger" *ngIf="passCtrl.touched && passCtrl.invalid">
                La clave debe tener al menos 6 caracteres.
              </ion-note>

              <!-- Repetí tu clave -->
              <ion-item class="ion-margin-top" [class.invalid]="confirmTouched && !passwordsMatch">
                <ion-label position="stacked">Repetí tu clave</ion-label>
                <ion-input
                  [type]="showPwd2 ? 'text' : 'password'"
                  required minlength="6"
                  [(ngModel)]="password2" name="password2" #pass2Ctrl="ngModel"
                  placeholder="Volvé a escribir tu clave"
                  (ionBlur)="confirmTouched = true"
                  (ionInput)="checkMatch()">
                </ion-input>

                <!-- Botón que copia la clave al campo de repetición -->
                <ion-button
                  fill="clear"
                  slot="end"
                  type="button"
                  (click)="copyPwdToConfirm()"
                  aria-label="Copiar clave en el campo repetir">
                  <ion-icon name="clipboard-outline"></ion-icon>
                </ion-button>

                <ion-button
                  fill="clear"
                  slot="end"
                  type="button"
                  (click)="togglePwd2()"
                  aria-label="Mostrar/Ocultar clave repetida">
                  <ion-icon [name]="showPwd2 ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                </ion-button>
              </ion-item>
              <ion-note color="danger" *ngIf="confirmTouched && !passwordsMatch">
                Las claves no coinciden.
              </ion-note>

              <!-- Mensaje de error general -->
              <ion-text color="danger" *ngIf="errorMsg" class="ion-margin-top" role="alert">
                {{ errorMsg }}
              </ion-text>

              <ion-button
                class="ion-margin-top"
                type="submit"
                expand="block"
                [disabled]="loading || !f.valid || !passwordsMatch">
                <ion-spinner *ngIf="loading" name="lines-small" class="ion-margin-end"></ion-spinner>
                Crear cuenta
              </ion-button>

              <div class="ion-text-center ion-margin-top">
                <ion-text>¿Ya tenés cuenta?</ion-text>
                <ion-button fill="clear" size="small" routerLink="/login">Iniciar sesión</ion-button>
              </div>
            </form>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
